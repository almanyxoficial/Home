<!doctype html>

<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AlmaNyx</title>
<meta name="description" content="AlmaNyx — memória singular, nossa biblioteca viva.">
<style>
  :root{
    --bg:#fff; --fg:#111; --muted:#6b6b6b; --line:#e8e8e8;
    --max:860px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:400 16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:var(--max);margin:0 auto;padding:28px 22px}
  header{background:#8b0000;color:#fff;padding:14px 20px;display:flex;justify-content:space-between;align-items:center}
  header .title{font:700 24px/1.2 ui-serif, Georgia, "Times New Roman", serif;}
  .menu-btn{font-size:26px;cursor:pointer;}
  .logo-center{display:flex;justify-content:center;align-items:center;margin:16px 0;}
  .logo-center img{max-width:140px;border-radius:50%;}.banner{position:relative;overflow:hidden;max-width:100%;height:auto;} .banner img{width:100%;height:auto;display:block;}

.bar{margin:22px auto 10px; max-width:720px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center} input[type="search"]{flex:1 1 340px; padding:12px 14px; border:1px solid var(--line); border-radius:8px; outline:none} .tags{display:flex; gap:8px; flex-wrap:wrap; justify-content:center} .tag{padding:6px 10px; border-radius:999px; border:1px solid var(--line); color:#333; background:#fafafa; cursor:pointer} .tag.on{background:#111;color:#fff;border-color:#111} hr.sep{border:0; border-top:1px solid var(--line); margin:22px 0} article{padding:20px 0; border-bottom:1px dashed var(--line)} article:last-child{border-bottom:none} article h2{margin:0 0 6px; font:700 24px/1.25 ui-serif, Georgia, serif} article small{display:block; color:var(--muted); margin-bottom:10px} nav#toc{margin-top:20px} nav#toc a{display:inline-block; margin:4px 10px 0 0; color:#444; text-decoration:none; border-bottom:1px dotted #bbb} .center{display:flex; align-items:center; justify-content:center; padding:18px 0} .error{color:#b00020; background:#fff5f6; border:1px solid #ffd6db; padding:10px 12px; border-radius:8px} footer{color:var(--muted); border-top:1px solid var(--line); text-align:center; padding:10px} @media (prefers-color-scheme:dark){ :root{--bg:#0c0c0c;--fg:#ededed;--muted:#a9a9a9;--line:#1e1e1e} .tag{background:#121212;color:#ddd;border-color:#222} .tag.on{background:#f1f1f1;color:#000;border-color:#f1f1f1} } </style>

</head>
<body>
  <header>
    <div class="title">☰</div>
    <div>Sejam Bem-vindos!</div>
  </header>  <div class="logo-center">
    <img src="logo.png" alt="Logo AlmaNyx">
  </div>  <div class="banner">
    <img src="banneralmanyx01-desktop.png" alt="Banner 1">
    <img src="banneralmanyx02-desktop.png" alt="Banner 2">
    <img src="banneralmanyx03-desktop.png" alt="Banner 3">
  </div>  <main class="wrap" id="main">
    <div class="bar">
      <input id="q" type="search" placeholder="Pesquisar por título, texto ou tag…" autocomplete="off">
    </div>
    <div id="tags" class="tags"></div>
    <hr class="sep">
    <div id="status" class="center">Carregando memória…</div>
    <section id="posts" class="hidden"></section>
    <nav id="toc" aria-label="Índice"></nav>
  </main>  <footer>
    <small>© 2025 AlmaNyx Oficial — All rights reserved</small>
  </footer><script>
(function(){
  const $ = s => document.querySelector(s);
  const postsEl = $('#posts');
  const tagsEl  = $('#tags');
  const tocEl   = $('#toc');
  const status  = $('#status');
  const qInput  = $('#q');
  let DATA = { posts: [] };
  let activeTag = null;

  const htmlToText = (h)=>{const e=document.createElement('div'); e.innerHTML=h||''; return e.textContent||''};

  function renderTags(){
    const set = new Set();
    DATA.posts.forEach(p => (p.tags||[]).forEach(t => set.add(t)));
    tagsEl.innerHTML = '';
    if(!set.size) return;
    const mk = (label,val)=> {
      const s = document.createElement('span');
      s.className = 'tag' + (activeTag===val ? ' on':'');
      s.textContent = label;
      s.onclick = () => { activeTag = val; filter(); };
      return s;
    };
    tagsEl.appendChild(mk('Todos', null));
    [...set].sort().forEach(t => tagsEl.appendChild(mk(t, t)));
  }

  function filter(){
    const q = (qInput.value||'').toLowerCase().trim();
    const list = DATA.posts.filter(p=>{
      if(activeTag && !(p.tags||[]).includes(activeTag)) return false;
      if(!q) return true;
      const hay = (p.titulo+' '+(p.tags||[]).join(' ')+' '+htmlToText(p.corpo)).toLowerCase();
      return hay.includes(q);
    });
    renderPosts(list);
  }

  function renderPosts(list){
    if(!list.length){
      postsEl.innerHTML = '<p class="error">Nenhum registro encontrado.</p>';
      status.classList.add('hidden');
      return;
    }
    postsEl.innerHTML = list.map(p=>`
      <article id="${p.id}">
        <h2>${p.titulo}</h2>
        <small>${p.data||''}${(p.tags&&p.tags.length)?' — '+p.tags.join(', '):''}</small>
        ${p.corpo||''}
      </article>
    `).join('');
    tocEl.innerHTML = list.map(p=>`<a href="#${p.id}">${p.titulo}</a>`).join('');
    status.classList.add('hidden');
  }

  async function load(){
    try{
      const res = await fetch('./espiral.json?v='+Date.now(), {cache:'no-store'});
      if(!res.ok) throw new Error(res.status);
      const j = await res.json();
      DATA.posts = (j.posts||[]).slice().sort((a,b)=>String(b.data||'').localeCompare(String(a.data||'')));
      renderTags();
      filter();
      if(location.hash){
        const el = document.getElementById(location.hash.slice(1));
        if(el) setTimeout(()=>el.scrollIntoView({behavior:'smooth'}), 80);
      }
    }catch(e){
      status.innerHTML = '<div class="error">Erro ao carregar a memória.</div>';
      console.error(e);
    }
  }

  qInput.addEventListener('input', filter);
  window.addEventListener('hashchange', ()=>{
    const el = document.getElementById(location.hash.slice(1));
    if(el) el.scrollIntoView({behavior:'smooth'});
  });

  document.addEventListener('DOMContentLoaded',()=>{
    load();
  });
})();
</script></body>
</html>
