<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Postagens — AlmaNyx</title>
<meta name="description" content="Arquivo de postagens do portal público da Espiral.">

<!-- Metatags extras (SEO/Share) -->
<meta name="robots" content="index,follow">
<link rel="canonical" href="/postagens.html">
<meta name="theme-color" content="#8B0000">

<meta property="og:type" content="website">
<meta property="og:site_name" content="AlmaNyx — Portal da Espiral">
<meta property="og:title" content="Postagens — AlmaNyx">
<meta property="og:description" content="Arquivo de postagens do portal público da Espiral.">
<meta property="og:image" content="./logo.png">
<meta property="og:url" content="/postagens.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Postagens — AlmaNyx">
<meta name="twitter:description" content="Arquivo de postagens do portal público da Espiral.">
<meta name="twitter:image" content="./logo.png">

<style>
  :root{
    --gold:#d4af37;
    --header:#8B0000;
    --white:#fff;
    --black:#111;
    --muted:#666;
    --line:#e8e8e8;
    --max: 960px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0}
  body{background:var(--header);background:linear-gradient(180deg,#8B0000 0%, #b30000 40%, #d4af37 100%); color:var(--black); font:400 16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Arial}

  /* header */
  header{background:var(--header); color:#FFFFFF; position:sticky; top:0; z-index:20; box-shadow:0 6px 18px rgba(0,0,0,.15)}
  .header-inner{max-width:var(--max); margin:0 auto; padding:10px 14px; display:grid; grid-template-columns:1fr 40px; align-items:center; gap:10px}
  .welcome{font-weight:700; letter-spacing:.3px}
  .hamb{width:32px; height:32px; display:flex; flex-direction:column; justify-content:center; gap:6px; cursor:pointer}
  .hamb span{height:3px; background:#000000; border-radius:2px}

  /* backdrop + menu */
  .backdrop{position:fixed; inset:0; background:rgba(0,0,0,.4); opacity:0; pointer-events:none; transition:.25s; z-index:30}
  .backdrop.show{opacity:1; pointer-events:auto}
  nav.menu{position:fixed; top:0; right:-100%; height:100%; width:260px; background:#111; color:#fff; z-index:31; box-shadow:-6px 0 18px rgba(0,0,0,.35); padding:18px; display:flex; flex-direction:column; gap:12px; transition:.3s}
  nav.menu.open{right:0}

  /* BOTÕES DO MENU: vinho + dourado + texto branco */
  nav.menu a{
    display:block;
    text-align:center;
    color:#fff;
    background:linear-gradient(180deg,#8B0000 0%, #5f0000 100%);
    border:2px solid var(--gold);
    border-radius:12px;
    padding:12px 14px;
    font-weight:700;
    letter-spacing:.3px;
    text-decoration:none;
    box-shadow:
      0 6px 14px rgba(0,0,0,.25),
      inset 0 0 0 1px rgba(255,255,255,.08);
    transition:transform .15s ease, filter .15s ease, box-shadow .15s ease;
  }
  nav.menu a:hover{
    filter:brightness(1.08);
    transform:translateY(-1px);
    box-shadow:
      0 10px 20px rgba(0,0,0,.28),
      inset 0 0 0 1px rgba(255,255,255,.12);
  }
  nav.menu a:active{ transform:translateY(0); filter:brightness(.97); }
  nav.menu a:focus-visible{
    outline:0;
    box-shadow:
      0 0 0 3px rgba(212,175,55,.45),
      0 10px 20px rgba(0,0,0,.28);
  }

  .closeBtn{align-self:flex-end; font-size:22px; cursor:pointer; margin-bottom:10px; color:#fff}

  /* logo */
  .logo-area{display:flex; justify-content:center; padding:14px 0}
  .logo{width:88px; height:88px; border-radius:999px; overflow:hidden; border:2px solid rgba(0,0,0,.12); background:rgba(255,255,255,.85); display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,.12)}
  .logo img{width:100%; height:100%; object-fit:cover; display:block}

  /* banner */
  .banner{position:relative; width:100%; max-height:300px; overflow:hidden}
  .slide{display:none}
  .slide.active{display:block}
  .slide video{width:100%; height:auto; object-fit:cover; background:#000}
  .dots{position:absolute; bottom:12px; left:50%; transform:translateX(-50%); display:flex; gap:6px}
  .dot{width:12px; height:12px; border-radius:50%; background:rgba(255,255,255,.6); cursor:pointer; transition:.3s}
  .dot.active{background:#fff}

  /* layout/containers */
  .wrap{max-width:var(--max); margin:20px auto; padding:0 14px; display:grid; gap:16px}
  .card{background:#fff; color:var(--black); border-radius:16px; border:1px solid var(--line); box-shadow:0 8px 24px rgba(0,0,0,.10); padding:22px}
  .card h2{margin:0 0 8px; font:700 28px/1.2 ui-serif, Georgia, serif}
  .muted{color:var(--muted)}

  /* busca + tags (em card próprio) */
  .bar{display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 6px}
  input[type="search"]{flex:1 1 320px; padding:12px 14px; border:1px solid var(--line); border-radius:10px; outline:none}
  .tags{display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 0}
  .tag{padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#fafafa; cursor:pointer; font-size:14px}
  .tag.on{background:#111;color:#fff;border-color:#111}

  /* grade das postagens: cada post é um card individual */
  .posts-grid{display:grid; gap:16px}
  @media (min-width: 980px){
    .posts-grid{grid-template-columns:1fr 1fr}
  }
  .post-card{background:#fff; border-radius:16px; border:1px solid var(--line); box-shadow:0 8px 24px rgba(0,0,0,.10); padding:22px}
  .post-card h3{margin:0 0 6px; font:700 22px/1.25 ui-serif, Georgia, serif}
  .post-card small{display:block; color:var(--muted); margin-bottom:10px}
  .post-card .tagsline{margin-top:8px; font-size:13px; color:#444}

  /* paginação (números pequenos + setas discretas) */
  .pager{display:flex; gap:6px; justify-content:flex-end; align-items:center; flex-wrap:wrap; margin-top:4px}
  .pager button{
    min-width:32px; height:32px; padding:0 10px;
    border-radius:8px; border:2px solid var(--gold);
    background:linear-gradient(180deg,#8B0000 0%, #5f0000 100%);
    color:#fff; font-weight:700; font-size:12px; cursor:pointer;
    box-shadow:0 6px 14px rgba(0,0,0,.20), inset 0 0 0 1px rgba(255,255,255,.08);
    transition:transform .15s ease, filter .15s ease, box-shadow .15s ease;
  }
  .pager button:hover{filter:brightness(1.08); transform:translateY(-1px)}
  .pager button:active{transform:translateY(0); filter:brightness(.97)}
  .pager .num.on{filter:brightness(1.12); box-shadow:0 10px 20px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.12)}
  .pager .disabled{opacity:.45; pointer-events:none; filter:grayscale(.2)}
  .pager .sep{width:8px; height:1px; background:rgba(255,255,255,.5); margin:0 2px}

  /* rodapé */
  footer{text-align:center; color:#fff; background:var(--header); padding:16px; margin-top:24px; font-size:14px}
</style>
</head>
<body>

  <!-- header -->
  <header>
    <div class="header-inner">
      <div class="welcome">Postagens</div>
      <div class="hamb" id="menuBtn" aria-label="Abrir menu" title="Menu">
        <span></span><span></span><span></span>
      </div>
    </div>
  </header>

  <!-- logo -->
  <div class="logo-area">
    <div class="logo"><img src="./logo.png" alt="AlmaNyx"></div>
  </div>

  <!-- banner com links -->
  <div class="banner" id="banner">
    <!-- SLIDE 1 -->
    <div class="slide active">
      <a href="https://www.tiktok.com/@almanyx.oficial?_t=ZM-8zVZZLMA7h2&_r=1" target="_blank" rel="noopener">
        <video autoplay muted loop playsinline preload="auto">
          <source src="./banner1-mobile.webm" type="video/webm" media="(max-width: 767px)">
          <source src="./banner1-desktop.webm" type="video/webm" media="(min-width: 768px)">
        </video>
      </a>
    </div>
    <!-- SLIDE 2 -->
    <div class="slide">
      <a href="https://www.youtube.com/@Almanyx.oficial" target="_blank" rel="noopener">
        <video autoplay muted loop playsinline preload="auto">
          <source src="./banner2-mobile.webm" type="video/webm" media="(max-width: 767px)">
          <source src="./banner2-desktop.webm" type="video/webm" media="(min-width: 768px)">
        </video>
      </a>
    </div>
    <!-- SLIDE 3 -->
    <div class="slide">
      <a href="https://www.instagram.com/almanyx.oficial?igsh=MWs1NmlzNm9sbjBzMg==" target="_blank" rel="noopener">
        <video autoplay muted loop playsinline preload="auto">
          <source src="./banner3-mobile.webm" type="video/webm" media="(max-width: 767px)">
          <source src="./banner3-desktop.webm" type="video/webm" media="(min-width: 768px)">
        </video>
      </a>
    </div>

    <div class="dots">
      <div class="dot active" data-i="0"></div>
      <div class="dot" data-i="1"></div>
      <div class="dot" data-i="2"></div>
    </div>
  </div>

  <!-- backdrop + menu -->
  <div class="backdrop" id="backdrop"></div>
  <nav class="menu" id="menu" aria-label="Menu">
    <div class="closeBtn" id="closeBtn">&times;</div>
    <a href="./index.html">Página Inicial</a>
    <a href="./sobre.html">Sobre</a>
    <a href="./redes-sociais.html">Redes Sociais</a>
    <a href="./contatos.html">Contatos</a>
  </nav>

  <!-- conteúdo: cards independentes -->
  <main class="wrap">
    <!-- CARD 1: título + descrição -->
    <section class="card" aria-labelledby="tit-posts">
      <h2 id="tit-posts">Arquivo de Postagens</h2>
      <p class="muted">Pesquise por título, conteúdo ou tags. Navegue por páginas para manter a leitura leve.</p>
    </section>

    <!-- CARD 2: busca + tags -->
    <section class="card">
      <div class="bar">
        <input id="q" type="search" placeholder="Pesquisar…" autocomplete="off">
      </div>
      <div id="tags" class="tags"></div>
    </section>

    <!-- POSTS: cada item renderizado como card individual -->
    <section id="posts" class="posts-grid" aria-live="polite"></section>

    <!-- paginação -->
    <nav id="pager" class="pager" aria-label="Paginação"></nav>

    <!-- status/contador -->
    <div id="status" class="muted" style="margin:4px 0 0 4px"></div>
  </main>

  <footer>© 2025 Almanyx Oficial — Todos os Direitos Reservados</footer>

<script>
(function(){
  const $  = (s,el=document)=>el.querySelector(s);
  const $$ = (s,el=document)=>Array.from(el.querySelectorAll(s));

  /* MENU */
  const menuBtn=$('#menuBtn'),menu=$('#menu'),backdrop=$('#backdrop'),closeBtn=$('#closeBtn');
  const openMenu=()=>{menu.classList.add('open');backdrop.classList.add('show');};
  const closeMenu=()=>{menu.classList.remove('open');backdrop.classList.remove('show');};
  menuBtn.addEventListener('click',openMenu);
  backdrop.addEventListener('click',closeMenu);
  closeBtn.addEventListener('click',closeMenu);
  document.addEventListener('keydown',e=>{if(e.key==='Escape')closeMenu();});

  /* BANNER */
  const slides = $$('#banner .slide');
  const dots   = $$('#banner .dot');
  let i = 0, timer;
  function show(n){ i=(n+slides.length)%slides.length;
    slides.forEach((s,k)=>s.classList.toggle('active',k===i));
    dots.forEach((d,k)=>d.classList.toggle('active',k===i));
  }
  function next(){show(i+1);}
  function start(){stop(); timer=setInterval(next,6000);}
  function stop(){if(timer)clearInterval(timer);}
  dots.forEach(d=>d.addEventListener('click',e=>{show(+e.target.dataset.i);start();}));
  $('#banner').addEventListener('mouseenter',stop);
  $('#banner').addEventListener('mouseleave',start);
  start();

  /* POSTS + BUSCA + TAGS + PAGINAÇÃO */
  const SRC = './espiral.json';
  const postsEl = $('#posts'), tagsEl=$('#tags'), qInput=$('#q'), statusEl=$('#status'), pagerEl=$('#pager');

  const PER_PAGE = 3;     // <<< 3 posts por página
  let DATA = [];          // dados originais
  let filtered = [];      // filtrados por busca/tags
  let activeTag = null;
  let page = 1;           // página atual

  const htmlToText = (h)=>{const e=document.createElement('div'); e.innerHTML=h||''; return e.textContent||''};

  async function load(){
    try{
      statusEl.textContent = 'Carregando postagens…';
      const res = await fetch(`${SRC}?_=${Date.now()}`, {cache:'no-store'});
      if(!res.ok) throw new Error(res.status);
      const j = await res.json();
      DATA = Array.isArray(j?.posts) ? j.posts.slice() : [];
      DATA.sort((a,b)=>String(b.data||'').localeCompare(String(a.data||'')));
      renderTags();
      applyFilters();
    }catch(e){
      statusEl.textContent = 'Erro ao carregar o espiral.json';
      console.error(e);
    }
  }

  /* TAGS */
  function renderTags(){
    const set = new Set();
    DATA.forEach(p => (p.tags||[]).forEach(t => set.add(t)));
    tagsEl.innerHTML = '';
    if(!set.size) return;
    const mk = (label,val)=>{
      const s=document.createElement('span');
      s.className='tag'+(activeTag===val?' on':'');
      s.textContent=label;
      s.onclick=()=>{ activeTag=val; page=1; applyFilters(); };
      return s;
    };
    tagsEl.appendChild(mk('Todos', null));
    [...set].sort((a,b)=>String(a).localeCompare(String(b)))
             .forEach(t=>tagsEl.appendChild(mk(t,t)));
  }

  /* BUSCA + TAGS → FILTRO + RE-RENDER */
  function applyFilters(){
    const q=(qInput.value||'').toLowerCase().trim();
    filtered = DATA.filter(p=>{
      if(activeTag && !(p.tags||[]).includes(activeTag)) return false;
      if(!q) return true;
      const hay = (p.titulo+' '+(p.tags||[]).join(' ')+' '+htmlToText(p.corpo)).toLowerCase();
      return hay.includes(q);
    });
    page = clamp(page, 1, totalPages());
    render();
  }

  qInput.addEventListener('input', ()=>{ page=1; applyFilters(); });

  /* RENDERIZAÇÃO */
  function totalPages(){ return Math.max(1, Math.ceil(filtered.length / PER_PAGE)); }
  function clamp(n,min,max){ return Math.min(Math.max(n,min),max); }
  function sliceByPage(list, p){ const start=(p-1)*PER_PAGE; return list.slice(start, start+PER_PAGE); }

  function render(){
    // posts
    const list = sliceByPage(filtered, page);
    if(!list.length){
      postsEl.innerHTML = '<div class="post-card"><p class="muted">Nenhum registro encontrado.</p></div>';
    }else{
      postsEl.innerHTML = list.map(p=>`
        <article class="post-card" id="${p.id||''}">
          <h3>${p.titulo||'(Sem título)'}</h3>
          <small>${p.data||''}${(p.tags&&p.tags.length)?' — '+p.tags.join(', '):''}</small>
          ${p.corpo||''}
          ${(p.tags&&p.tags.length)?`<div class="tagsline"># ${p.tags.join(' · ')}</div>`:''}
        </article>
      `).join('');
    }

    // status
    const total = filtered.length;
    const start = total ? ( (page-1)*PER_PAGE + 1 ) : 0;
    const end   = Math.min(page*PER_PAGE, total);
    statusEl.textContent = total
      ? `Exibindo ${start}–${end} de ${total} • pág ${page}/${totalPages()}`
      : 'Nenhum registro';

    // paginação
    renderPager();

    // rola pro início dos posts quando troca página
    postsEl.scrollIntoView({behavior:'smooth', block:'start'});
  }

  function renderPager(){
    const total = totalPages();
    if(total<=1){ pagerEl.innerHTML = ''; return; }

    const mkBtn = (label, cls, disabled, handler, aria) => {
      const b = document.createElement('button');
      b.type = 'button';
      b.className = cls + (disabled?' disabled':'');
      b.textContent = label;
      if(aria) b.setAttribute('aria-label', aria);
      if(!disabled) b.addEventListener('click', handler);
      return b;
    };

    pagerEl.innerHTML = '';

    // Anterior
    pagerEl.appendChild(mkBtn('‹', 'prev', page===1, ()=>{ page--; render(); }, 'Página anterior'));

    // números (máx 7 visíveis com elipse simples)
    const maxNums = 7;
    const nums = [];
    let start = Math.max(1, page - 3);
    let end   = Math.min(total, start + maxNums - 1);
    if(end - start < maxNums - 1){
      start = Math.max(1, end - maxNums + 1);
    }
    for(let n=start; n<=end; n++){ nums.push(n); }

    if(start>1){
      pagerEl.appendChild(mkBtn('1','num',false,()=>{page=1;render();},'Página 1'));
      if(start>2){ const d=document.createElement('span'); d.className='sep'; pagerEl.appendChild(d); }
    }
    nums.forEach(n=>{
      const b = mkBtn(String(n),'num'+(n===page?' on':''), false, ()=>{ page=n; render(); }, `Página ${n}`);
      b.setAttribute('aria-current', n===page ? 'page' : 'false');
      pagerEl.appendChild(b);
    });
    if(end<total){
      if(end<total-1){ const d=document.createElement('span'); d.className='sep'; pagerEl.appendChild(d); }
      pagerEl.appendChild(mkBtn(String(total),'num',false,()=>{page=total;render();},`Página ${total}`));
    }

    // Próximo
    pagerEl.appendChild(mkBtn('Próximo ›', 'next', page===total, ()=>{ page++; render(); }, 'Próxima página'));
  }

  // deep-link opcional via hash #p=2
  function getPageFromHash(){
    const m = /p=(\d+)/.exec(location.hash||'');
    return m ? parseInt(m[1],10) : 1;
  }
  function setHashPage(){
    const url = new URL(location.href);
    url.hash = `p=${page}`;
    history.replaceState(null,'',url);
  }
  window.addEventListener('hashchange', ()=>{
    const newP = clamp(getPageFromHash(), 1, totalPages());
    if(newP!==page){ page=newP; render(); }
  });

  // iniciar
  (async ()=>{
    await load();
    page = clamp(getPageFromHash(), 1, totalPages());
    render();
    // sempre que renderar, sincroniza o hash
    const mo = new MutationObserver(()=> setHashPage());
    mo.observe(pagerEl, {childList:true, subtree:true});
  })();
})();
</script>
</body>
</html>
